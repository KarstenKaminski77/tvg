{% extends 'layout_distributor.html.twig' %}

{% block title %}Hello DistributorsController!{% endblock %}

{% block body %}
    <div class="hidden users-flash mb-0" id="flash"></div>
    <div class="container-fluid pe-4">
        <div class="row flex-nowrap">
            <div class="col-2 col-sm-2 col-md-3 col-xl-2 px-sm-2 px-0 bg-light border-right">
                <div class="d-flex flex-column align-items-center align-items-sm-start px-3 pt-2 text-white min-vh-100 text-truncate overflow-hidden">
                    <a href="/" class="d-flex align-items-center pb-3 mb-md-0 me-md-auto text-white text-decoration-none distributor-logo-container">
                        <img src="{{ asset('images/logo-150.png') }}" class="img-fluid distributor-logo">
                    </a>
                    <ul class="nav nav-pills flex-column mb-sm-auto mb-0 align-items-center align-items-sm-start" id="menu">
                        <li class="nav-item">
                            <a href="#" class="nav-link align-middle px-0 text-primary">
                                <i class="fa-solid fa-house"></i>
                                <span class="ms-1 d-none d-sm-inline">Home</span>
                            </a>
                        </li>
                        <li class="text">
                            <a href="#submenu1" data-bs-toggle="collapse" class="nav-link px-0 align-middle text-primary collapsed text-center text-sm-start" aria-expanded="false">
                                <i class="fa-solid fa-user-gear"></i>
                                <span class="ms-1 d-none d-sm-inline">My Account</span>
                            </a>
                            <ul class="nav flex-column ms-1 collapse" id="submenu1" data-bs-parent="#menu" style="">
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="account_settings_link">
                                        <i class="fa-solid fa-screwdriver-wrench"></i>
                                        <span class="ms-1 d-none d-sm-inline">Company Information</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="about_link">
                                        <i class="fa-solid fa-circle-question"></i>
                                        <span class="ms-1 d-none d-sm-inline">About</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="operating_hours_link">
                                        <i class="fa-solid fa-clock"></i>
                                        <span class="ms-1 d-none d-sm-inline">Operating Hours</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="refund_policy_link">
                                        <i class="fa-solid fa-rotate-left"></i>
                                        <span class="ms-1 d-none d-sm-inline">Refund Policy</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="sales_tax_policy_link">
                                        <i class="fa-solid fa-scale-unbalanced"></i>
                                        <span class="ms-1 d-none d-sm-inline">Sale Tax Policy</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a href="#" class="nav-link align-middle text-primary" id="shipping_policy_link">
                                        <i class="fa-solid fa-truck"></i>
                                        <span class="ms-1 d-none d-sm-inline">Shipping Policy</span>
                                    </a>
                                </li>
                                <li class="w-100">
                                    <a class="nav-link align-middle text-primary" href="#" id="users_link">
                                        <i class="fa-solid fa-address-book"></i>
                                        <span class="ms-1 d-none d-sm-inline">Users</span>
                                    </a>
                                </li>
                            </ul>
                        </li>
                        <li>
                            <a
                                href="#"
                                data-bs-toggle="collapse"
                                class="nav-link px-0 align-middle text-primary"
                                data-distributor-id="{{ distributor.id }}"
                                id="orders_link"
                            >
                                <i class="fa-solid fa-file-invoice"></i>&nbsp;&nbsp;
                                <span class="ms-1 d-none d-sm-inline">Orders</span>
                            </a>
                        </li>
                        <li>
                            <a class="nav-link px-0 align-middle text-primary" href="#" id="inventory_link">
                                <i class="fa-solid fa-cart-flatbed"></i>
                                <span class="ms-1 d-none d-sm-inline">Invetory</span>
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
            <div class="col-10 col-sm-10 py-3">
                <div class="ps-3">

                    {# Account & Settings #}
                    <div class="row hidden" id="account_settings">
                        <div class="col-12 bg-primary bg-gradient text-center mt-1 mt-sm-5 pt-3 pb-3">
                            <h4 class="text-white text-truncate">Account & Settings</h4>
                            <span class="text-white d-none d-sm-inline">
                                Company Information
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_company_information', 'attr': {'id': 'form_company_information'}})}}
                        <div class="row mb-3 pt-2 pt-sm-3 bg-light border-left border-right">

                            {# Company name #}
                            <div class="col-12 col-sm-6">
                                <label>
                                    Company Name
                                </label>
                                {{ form_widget(form.distributorName,{id: 'distributor_name', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Distributor Name*',
                                    'value': distributor.distributorName
                                }}) }}
                                <div class="hidden_msg" id="error_distributor_name">
                                    Required Field
                                </div>
                            </div>

                            {# Website #}
                            <div class="col-12 col-sm-6">
                                <label>
                                    Website
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon1">https://</span>
                                    {{ form_widget(form.website,{id: 'website', 'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Website',
                                        'value': distributor.website
                                    }}) }}
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3 bg-light border-left border-right">

                            {# Email #}
                            <div class="col-12 col-sm-6">
                                <label>
                                    Email Address
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text" id="basic-addon1">@</span>
                                    {{ form_widget(form.email,{id: 'email', 'attr': {
                                        'class': 'form-control',
                                        'placeholder': 'Email*',
                                        'value': distributor.email
                                    }}) }}
                                </div>
                                <div class="hidden_msg" id="error_email">
                                    Required Field
                                </div>
                            </div>

                            {# Telephone #}
                            <div class="col-12 col-sm-6">
                                <label>
                                    Telephone
                                </label>
                                <input
                                        type="hidden"
                                        name="distributor_form[telephone]"
                                        value="{{ distributor.telephone }}"
                                        id="telephone"
                                >
                                <input
                                        type="text"
                                        name="mobile"
                                        placeholder="Telephone*"
                                        value="{{ distributor.telephone }}"
                                        id="mobile"
                                        class="form-control"
                                >
                                <div class="hidden_msg" id="error_telephone">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3 bg-light border-left border-right">

                            {# Logo #}
                            <div class="col-12 col-sm-6">
                                <div class="row m-0">
                                    <div class="col-11 ps-0" id="logo_file">
                                        <label>
                                            Logo
                                        </label>
                                        {{ form_widget(form.logo,{id: 'logo', 'attr': {
                                            'class': 'form-control',
                                            'placeholder': 'Logo',
                                            'value': distributor.logo
                                        }}) }}
                                    </div>
                                    <div class="col-1 hidden ps-0 pe-0" id="logo_col">
                                        <a href="" data-bs-toggle="modal" data-bs-target="#modal_logo">
                                            <i class="fa-solid fa-image img-icon float-end"></i>
                                        </a>
                                    </div>
                                </div>
                            </div>

                            {# Country #}
                            <div class="col-12 col-sm-6">
                                <label>
                                    Country
                                </label>
                                {% set country_id = '' %}
                                {% if distributor.addressCountry|length > 0 %}
                                    {% set country_id = distributor.addressCountry.id %}
                                {% endif %}
                                {{ form_widget(form.addressCountry,{id: 'country', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Country',
                                    'value': country_id,
                                }}) }}
                                <div class="hidden_msg" id="error_country">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3 bg-light border-left border-right">

                            {# Street #}
                            <div class="col-12 col-sm-6">
                                <labe>
                                    Street Address
                                </labe>
                                {{ form_widget(form.addressStreet,{id: 'street_address', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Street Address',
                                    'value': distributor.addressStreet
                                }}) }}
                                <div class="hidden_msg" id="error_street_address">
                                    Required Field
                                </div>
                            </div>

                            {# City #}
                            <div class="col-12 col-sm-6">
                                <labe>
                                    City
                                </labe>
                                {{ form_widget(form.addressCity,{id: 'city', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'City',
                                    'value': distributor.addressCity
                                }}) }}
                                <div class="hidden_msg" id="error_city">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3 pb-3 bg-light border-left border-right border-bottom">

                            {# Postal Code #}
                            <div class="col-12 col-sm-6">
                                <labe>
                                    Postal Code
                                </labe>
                                {{ form_widget(form.addressPostalCode,{id: 'postal_code', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Postal Code',
                                    'value': distributor.addressPostalCode
                                }}) }}
                                <div class="hidden_msg" id="error_postal_code">
                                    Required Field
                                </div>
                            </div>

                            {# State #}
                            <div class="col-12 col-sm-6">
                                <labe>
                                    State
                                </labe>
                                {{ form_widget(form.addressState,{id: 'state', 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'State',
                                    'value': distributor.addressState
                                }}) }}
                                <div class="hidden_msg" id="error_state">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row">
                            <div class="col-12 mt-1 mb-5 ps-0 pe-0">
                                <input id="btn_company_information" type="submit" class="btn btn-primary w-100" value="UPDATE COMPANY INFORMATION">
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}

                        {# Modal Logo #}
                        <div class="modal fade" id="modal_logo" tabindex="-1" aria-labelledby="product_delete_label" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <div class="modal-header" style="border: none; padding-bottom: 0">
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body" style="padding: 0">
                                        <div class="row">
                                            <div class="col-12 mb-0 text-center">
                                                <img src="{{ asset('images/logos/' ~ distributor.logo) }}" id="logo_img" class="img-fluid">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {# End Account & Settings #}

                    {# About #}
                    <div class="row hidden" id="about">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">About</h3>
                            <span class="mb-5 mt-2 text-center text-light text-sm-start d-none d-sm-inline">
                                Lorem ipsum dolor sit amet
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_about_us', 'attr': {'id': 'form_about_us', 'class':'col-12 ps-0 pe-0'}})}}

                        <div class="col-12">
                            {{ form_widget(form.about,{'id': 'about_us', 'value': distributor.about, 'attr': {
                                'class': 'form-control',
                                'placeholder': 'About*'
                            }}) }}
                            <div class="hidden_msg" id="error_about_us">
                                Required Field
                            </div>
                        </div>

                        <div class="col-12 mb-5">
                            <button id="btn_about_us" type="submit" class="btn btn-primary w-100">UPDATE ABOUT US</button>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End About #}

                    {# Operating Hours #}
                    <div class="row hidden" id="operating_hours">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">Operating Hours</h3>
                            <span class="mb-5 mt-2 text-center text-light text-sm-start d-none d-sm-inline">
                                Lorem ipsum dolor sit amet
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_operating_hours', 'attr': {'id': 'form_operating_hours', 'class':'col-12 ps-0 pe-0'}})}}

                        <div class="row">
                            <div class="col-12">
                                {{ form_widget(form.operatingHours,{'id': 'operating_hours_field', 'value': distributor.operatingHours, 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Operating Hours*'
                                }}) }}
                                <div class="hidden_msg" id="error_operating_hours">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12 mb-5">
                                <button id="btn_operating_hours" type="submit" class="btn btn-primary w-100">UPDATE OPERATING HOURS</button>
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End Operating Hours #}

                    {# Refund Policy #}
                    <div class="row hidden" id="refund_policy">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">Refund Policy</h3>
                            <span class="mb-5 mt-2 text-center text-light text-sm-start d-none d-sm-inline">
                                Lorem ipsum dolor sit amet
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_refund_policy', 'attr': {'id': 'form_refund_policy', 'class':'col-12 ps-0 pe-0'}})}}

                        <div class="row">
                            <div class="col-12">
                                {{ form_widget(form.refundPolicy,{'id': 'refund_policy_field', 'value': distributor.refundPolicy, 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Refund Policy*'
                                }}) }}
                                <div class="hidden_msg" id="error_refund_policy">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12 mb-5">
                                <button id="btn_refund_policy" type="submit" class="btn btn-primary w-100">UPDATE OPERATING HOURS</button>
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End Refund Policy #}

                    {# Sales Tax Policy #}
                    <div class="row hidden" id="sales_tax_policy">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">Sales Tax Policy</h3>
                            <span class="mb-5 mt-2 text-center text-light text-sm-start d-none d-sm-inline">
                                Lorem ipsum dolor sit amet
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_sales_tax_policy', 'attr': {'id': 'form_sales_tax_policy', 'class':'col-12 ps-0 pe-0'}})}}

                        <div class="row">
                            <div class="col-12">
                                {{ form_widget(form.salesTaxPolicy,{'id': 'sales_tax_policy_field', 'value': distributor.salesTaxPolicy, 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Sales Tax Policy*'
                                }}) }}
                                <div class="hidden_msg" id="error_sales_tax_policy">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12 mb-5">
                                <button id="btn_sales_tax_policy" type="submit" class="btn btn-primary w-100">UPDATE OPERATING HOURS</button>
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End Sales Tax Policy #}

                    {# Shipping Policy #}
                    <div class="row hidden" id="shipping_policy">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">Shipping Policy</h3>
                            <span class="mb-5 mt-2 text-center text-light text-sm-start d-none d-sm-inline">
                                Lorem ipsum dolor sit amet
                            </span>
                        </div>
                        {{form_start(form, {'name': 'form_shipping_policy', 'attr': {'id': 'form_shipping_policy', 'class':'col-12 ps-0 pe-0'}})}}

                        <div class="row">
                            <div class="col-12">
                                {{ form_widget(form.shippingPolicy,{'id': 'shipping_policy_field', 'value': distributor.shippingPolicy, 'attr': {
                                    'class': 'form-control',
                                    'placeholder': 'Shipping Policy*'
                                }}) }}
                                <div class="hidden_msg" id="error_shipping_policy">
                                    Required Field
                                </div>
                            </div>
                        </div>

                        <div class="row mb-3">
                            <div class="col-12 mb-5">
                                <button id="btn_shipping_policy" type="submit" class="btn btn-primary w-100">UPDATE OPERATING HOURS</button>
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End Sales Tax Policy #}

                    {# Invenory / Distributor Products #}
                    <div id="inventory" id="inventory_search">
                        {{form_start(form, {'name': 'form_inventory_item', 'attr': {'id': 'form_inventory_item'}})}}
                        {{ form_widget(inventory_form.product,{'id': 'product_id'}) }}
                        {{ form_widget(inventory_form.distributor,{'id': 'distributor_id'}) }}
                        <div class="row">
                            <div class="col-12 bg-primary bg-gradient text-center mt-1 mt-sm-5 pt-3 pb-3" id="order_header">
                                <h4 class="text-white text-truncate">Inventory</h4>
                                <span class="text-white d-none d-sm-inline">
                                    Manage Your Inventory
                                </span>
                            </div>
                            <div class="col-12 pt-2 pb-2 bg-light border-left border-right border-bottom">
                                <input type="text" id="search_field" class="form-control" placeholder="Inventory Item" autocomplete="off" />
                                <div id="suggestion_field"></div>
                            </div>
                        </div>
                        <div id="inventory_item" class="row bg-light border-left border-right border-bottom">
                            <div class="row mb-3 pe-0">

                                {# Dosage #}
                                <div class="col-12 col-sm-6 pe-0 pe-sm-2">
                                    <label>
                                        Dosage
                                    </label>
                                    <input type="text" class="form-control" id="dosage" disabled value="">
                                </div>

                                {# Size #}
                                <div class="col-12 col-sm-6 pe-0">
                                    <label>
                                        Size
                                    </label>
                                    <input type="text" class="form-control" id="size" disabled value="">
                                </div>
                            </div>

                            <div class="row mb-3 pe-0">

                                {# Active Ingredient #}
                                <div class="col-12 col-sm-6 pe-0 pe-sm-2">
                                    <label>
                                        Active Ingredient
                                    </label>
                                    <input type="text" class="form-control" id="active_ingredient" disabled value="">
                                </div>

                                {# Pack Type #}
                                <div class="col-12 col-sm-6 pe-0">
                                    <label>
                                        Pack Type
                                    </label>
                                    <input type="text" class="form-control" id="pack_type" disabled value="">
                                </div>
                            </div>

                            <div class="row mb-3 pe-0">

                                {# Unit #}
                                <div class="col-12 col-sm-6 pe-0 pe-sm-2">
                                    <label>
                                        Unit
                                    </label>
                                    <input type="text" class="form-control" id="unit" disabled value="">
                                </div>

                                {# SKU #}
                                <div class="col-12 col-sm-6 pe-0">
                                    <label>
                                        #SKU
                                    </label>
                                    {{ form_widget(inventory_form.sku,{'id': 'sku', 'attr':{
                                        'class': 'form-control',
                                        'placeholder': 'SKU'
                                    }}) }}
                                    <div class="hidden_msg" id="error_sku">
                                        Required Field
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3 pe-0">

                                {# Serial Number #}
                                <div class="col-12 col-sm-6 pe-0 pe-sm-2">
                                    <label>
                                        Serial Number
                                    </label>
                                    {{ form_widget(inventory_form.distributorNo,{'id': 'distributor_no', 'attr':{
                                        'class': 'form-control',
                                        'placeholder': 'Serial Number'
                                    }}) }}
                                    <div class="hidden_msg" id="error_distributor_no">
                                        Required Field
                                    </div>
                                </div>

                                {# Unit Price #}
                                <div class="col-12 col-sm-6 pe-0">
                                    <label>
                                        Unit Price
                                    </label>
                                    {{ form_widget(inventory_form.unitPrice,{'id': 'unit_price', 'attr':{
                                        'class': 'form-control',
                                        'placeholder': 'Unit Price'
                                    }}) }}
                                    <div class="hidden_msg" id="error_unit_price">
                                        Required Field
                                    </div>
                                </div>
                            </div>

                            <div class="row mb-3 pe-0">

                                {# Stock Level #}
                                <div class="col-12 col-sm-6 pe-0 pe-sm-2">
                                    <label>
                                        Stock Level
                                    </label>
                                    {{ form_widget(inventory_form.stockCount,{'id': 'stock_count', 'attr':{
                                        'class': 'form-control',
                                        'placeholder': 'Stock Level'
                                    }}) }}
                                    <div class="hidden_msg" id="error_stock_count">
                                        Required Field
                                    </div>
                                </div>

                                {# Expiry Date #}
                                <div class="col-12 col-sm-6 pe-0">
                                    <label>
                                        Expiry Date
                                    </label>
                                    {{ form_widget(inventory_form.expiryDate,{'id': 'expiry_date', 'attr':{
                                        'class': 'form-control',
                                    }}) }}
                                </div>
                            </div>

                            <div class="row mb-3 pe-0">

                                {# Tax Empt #}
                                <div class="col-12">
                                    <label class="d-block">
                                        Tax Exempt
                                    </label>
                                    <div class="form-check form-check-inline radio-label">
                                        <input type="radio" class="form-check-input" id="taxExempt_1" name="distributor_products_form[taxExempt]" value="1">
                                        <label for="distributor_products_form_taxExempt_1" class="radio-text">Yes</label>
                                    </div>
                                    <div class="form-check form-check-inline radio-label">
                                        <input type="radio" class="form-check-input" id="taxExempt_0" name="distributor_products_form[taxExempt]" value="0">
                                        <label for="distributor_products_form_taxExempt_0" class="radio-text">No</label>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row mb-3" id="inventory_btn">
                            <div class="col-12 mt-3 ps-0 pe-0">
                                <button id="btn_inventory" type="submit" class="btn btn-primary w-100"></button>
                            </div>
                            <div class="col-12 mb-3 ps-0 pe-0 mt-3">
                                <button type="button" id="inventory_clear" class="btn btn-secondary w-100">
                                    <i class="fa-solid fa-circle-xmark me-2"></i>
                                    CLEAR SEARCH
                                </button>
                            </div>
                        </div>
                        {{ form_end(form, {render_rest: false}) }}
                    </div>
                    {# End Invenory / Distributor Products #}

                    {# Users #}
                    <div class="row hidden" id="users">
                        <div class="col-12 bg-primary bg-gradient text-center pt-3 pb-3 mt-1 mt-sm-5">
                            <h3 class="text-light text-truncate">Manage User Accounts</h3>
                            <span class="d-none d-sm-inline mb-5 mt-2 text-center text-light text-sm-start">
                                Fluid supports having several users under a single clinic. Each user will have their own login, can
                                independently participate in the Fluid discussions. You have full control over editing the permissions
                                of each user in your clinic. Use the table below to view the available permission levels.
                            </span>
                        </div>
                        <div class="col-12 d-none d-xl-block">
                            <div class="row">
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom border-left">
                                    First Name
                                </div>
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom">
                                    Last Name
                                </div>
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom">
                                    Username
                                </div>
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom">
                                    Telephone
                                </div>
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom">
                                    Position
                                </div>
                                <div class="col-md-2 pt-3 pb-3 text-primary fw-bold bg-light border-bottom border-right">

                                </div>
                            </div>
                        </div>
                        <div class="col-12" id="users_list">
                            {% for user in users %}
                                <div class="row border-left border-right border-bottom bg-light">
                                    <div class="col-5 col-md-2 d-xl-none t-cell fw-bold text-primary text-truncate border-list pt-3 pb-3">
                                        First Name:
                                    </div>
                                    <div class="col-7 col-md-10 col-xl-2 text-truncate border-list pt-3 pb-3">
                                        {{ user.firstName }}
                                    </div>
                                    <div class="col-5 col-md-2 d-xl-none t-cell fw-bold text-primary text-truncate border-list pt-3 pb-3">
                                        Last Name:
                                    </div>
                                    <div class="col-7 col-md-10 col-xl-2 text-truncate border-list pt-3 pb-3">
                                        {{ user.lastName }}
                                    </div>
                                    <div class="col-5 col-md-2 d-xl-none t-cell fw-bold text-primary text-truncate border-list pt-3 pb-3">
                                        Email:
                                    </div>
                                    <div class="col-7 col-md-10 col-xl-2 text-truncate border-list pt-3 pb-3">
                                        {{ user.email }}
                                    </div>
                                    <div class="col-5 col-md-2 d-xl-none t-cell fw-bold text-primary text-truncate border-list pt-3 pb-3">
                                        Telephone:
                                    </div>
                                    <div class="col-7 col-md-10 col-xl-2 text-truncate border-list pt-3 pb-3">
                                        {{ user.telephone }}
                                    </div>
                                    <div class="col-5 col-md-2 d-xl-none t-cell fw-bold text-primary text-truncate border-list pt-3 pb-3">
                                        Position:
                                    </div>
                                    <div class="col-7 col-md-10 col-xl-2 text-truncate border-list pt-3 pb-3">
                                        {{ user.position }}
                                    </div>
                                    <div class="col-md-2  t-cell text-truncate border-list pt-3 pb-3">
                                        <a href="" class="float-end update-user" data-user-id="{{ user.id }}" data-bs-toggle="modal" data-bs-target="#modal_user">
                                            <i class="fa-solid fa-pen-to-square edit-icon"></i>
                                        </a>
                                        <a href="" class="delete-icon float-end delete-user" data-bs-toggle="modal"
                                           data-user-id="{{ user.id }}" data-bs-target="#modal_user_delete"
                                        >
                                            <i class="fa-solid fa-trash-can"></i>
                                        </a>
                                    </div>
                                </div>
                            {% endfor %}

                            {{ users_pagination|raw }}
                        </div>

                        {# Modal Manage Users #}
                        <div class="modal fade" id="modal_user" tabindex="-1" aria-labelledby="modal_user" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered modal-lg">
                                <div class="modal-content">
                                    {{form_start(form, {'name': 'form_users', 'attr': {'id': 'form_users'}})}}
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="user_modal_label"></h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row mb-3">

                                            {# First Name #}
                                            <div class="col-12 col-sm-6">
                                                {{ form_label(user_form.firstName) }}
                                                <input type="hidden" value="" name="distributor_users_form[user_id]" id="user_id">
                                                {{ form_widget(user_form.firstName,{'id': 'user_first_name', 'attr':{
                                                    'class': 'form-control',
                                                    'placeholder': 'First Name*'
                                                }}) }}
                                                <div class="hidden_msg" id="error_user_first_name">
                                                    Required Field
                                                </div>
                                            </div>

                                            {# Last Name #}
                                            <div class="col-12 col-sm-6">
                                                {{ form_label(user_form.lastName) }}
                                                {{ form_widget(user_form.lastName,{'id': 'user_last_name', 'attr':{
                                                    'class': 'form-control',
                                                    'placeholder': 'Last Name*'
                                                }}) }}
                                                <div class="hidden_msg" id="error_user_last_name">
                                                    Required Field
                                                </div>
                                            </div>
                                        </div>

                                        <div class="row mb-3">

                                            {# Email #}
                                            <div class="col-12 col-sm-6">
                                                {{ form_label(user_form.email) }}
                                                {{ form_widget(user_form.email,{'id': 'user_email', 'attr':{
                                                    'class': 'form-control',
                                                    'placeholder': 'Email Address'
                                                }}) }}
                                                <div class="hidden_msg" id="error_user_email">
                                                    Required Field
                                                </div>
                                            </div>

                                            {# Telephone Number #}
                                            <div class="col-12 col-sm-6">
                                                {{ form_label(user_form.telephone) }}
                                                <span id="telephone_container">
                                            <input
                                                    type="text"
                                                    class="form-control"
                                                    name="distributor_users_form[mobile]"
                                                    id="user_mobile" value=""
                                                    placeholder="(123) 456-7890*"
                                            >
                                        </span>

                                                <div class="hidden_msg" id="error_user_telephone">
                                                    Required Field
                                                </div>
                                                <input type="hidden" name="distributor_users_form[telephone]" id="user_telephone" value="">
                                                {{ form_widget(user_form.isoCode, {'id': 'user_iso_code'}) }}
                                                {{ form_widget(user_form.intlCode, {'id': 'user_intl_code'}) }}
                                            </div>
                                        </div>

                                        <div class="row mb-3">

                                            {# Position #}
                                            <div class="col-12">
                                                {{ form_label(user_form.position) }}
                                                {{ form_widget(user_form.position,{'id': 'user_position', 'attr':{
                                                    'class': 'form-control',
                                                    'placeholder': 'Position'
                                                }}) }}
                                                <div class="hidden_msg" id="error_user_telephone">
                                                    Required Field
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">CANCEL</button>
                                        <button type="submit" class="btn btn-primary" id="create_user">SAVE</button>
                                    </div>
                                    {{ form_end(form, {render_rest: false}) }}
                                </div>
                            </div>
                        </div>

                        {# Modal Delete User #}
                        <div class="modal fade" id="modal_user_delete" tabindex="-1" aria-labelledby="user_delete_label" aria-hidden="true">
                            <div class="modal-dialog modal-dialog-centered">
                                <div class="modal-content">
                                    <input type="hidden" value="" name="addresses_form[address_id]" id="address_id">
                                    <div class="modal-header">
                                        <h5 class="modal-title" id="user_delete_label">Delete User</h5>
                                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                    </div>
                                    <div class="modal-body">
                                        <div class="row">
                                            <div class="col-12 mb-0">
                                                Are you sure you would like to delete this user? This action cannot be undone.
                                            </div>
                                        </div>
                                    </div>
                                    <div class="modal-footer">
                                        <button type="button" class="btn btn-primary btn-sm" data-bs-dismiss="modal">CANCEL</button>
                                        <button type="submit" class="btn btn-danger btn-sm" id="delete_user">DELETE</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {# End Users #}

                    {# Orders #}
                    <div id="order_container"></div>
                    {# End Orders #}

                </div>
            </div>
        </div>
    </div>
    <div class="overlay"></div>
    <div class="spanner">
        <div class="loader"></div>
        <p>Loading...</p>
    </div>
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>

        $(document).ready(function(){

            let input = '';
            let iti = '';

            function getFlash(flash){
                $('#flash').addClass('alert-success').removeClass('alert-danger').addClass('alert').addClass('text-center');
                $('#flash').removeClass('users-flash').addClass('users-flash').empty().append(flash).removeClass('hidden');

                setTimeout(function() {
                    $('#flash').removeClass('alert-success').removeClass('alert').removeClass('text-center');
                    $('#flash').removeClass('users-flash').empty().addClass('hidden');
                }, 5000);
            }

            let brand = $('#brand');
            let account_settings = $('#account_settings');
            let about = $('#about');
            let operating_hours = $('#operating_hours');
            let refund_policy = $('#refund_policy');
            let sales_tax_policy = $('#sales_tax_policy');
            let shipping_policy = $('#shipping_policy');
            let inventory = $('#inventory');
            let inventory_search = $('#inventory_search');
            let inventory_item = $('#inventory_item');
            let inventory_btn = $('#inventory_btn');
            let users = $('#users');
            let inventory_clear = $('#inventory_clear');
            let order_container = $('#order_container');
            let get_messages = '';
            let date = new Date();
            let date_time = date.getFullYear() +'-'+ (date.getMonth() + 1) +'-'+ date.getDate() +' '+ String(date.getHours()).padStart(2, "0") + ":" + String(date.getMinutes()).padStart(2, "0") +':'+ String(date.getSeconds()).padStart(2, '0');
            sessionStorage.setItem('date_time', date_time);

            account_settings.hide();
            brand.empty().hide();
            about.hide();
            operating_hours.hide();
            refund_policy.hide();
            sales_tax_policy.hide();
            shipping_policy.hide();
            inventory.hide();
            inventory_search.hide();
            inventory_item.hide();
            users.hide();
            inventory_clear.hide();
            order_container.hide();
            $('#btn_inventory').hide();

            {# Get correct content on refresh #}
            let uri = '{{ app.request.requestUri }}';
            let is_account_settings = uri.match('/distributors/account');
            let is_about = uri.match('/distributors/about');
            let is_operating_hours = uri.match('/distributors/operating-hours');
            let is_refund_policy = uri.match('/distributors/refund-policy');
            let is_sales_tax_policy = uri.match('/distributors/sales-tax-policy');
            let is_shipping_policy = uri.match('/distributors/shipping-policy');
            let is_inventory = uri.match('/distributors/manage-inventory');
            let is_users = uri.match('/distributors/users');

            {# Account & Settings #}
            if(is_account_settings != null) {

                getAccountSettings();
            }

            {# About #}
            if(is_about != null) {

                getAbout();
            }

            {# Operating Hours #}
            if(is_operating_hours != null) {

                getOperatingHours();
            }

            {# Refund Policy #}
            if(is_refund_policy != null) {

                getRefundPolicy();
            }

            {# Sales Tax Policy #}
            if(is_sales_tax_policy != null) {

                getSalesTaxPolicy();
            }

            {# Shipping Policy #}
            if(is_shipping_policy != null) {

                getShippingPolicy();
            }

            {# Inventory #}
            if(is_inventory != null) {

                getInventory();
            }

            {# Users #}
            if(is_users != null) {

                getUsers();
            }

            {# Orders #}
            {# Orders List #}
            function getOrdersList(distributor_id, page_id){

                $.ajax({
                    url: "{{ path('distributor_get_order_list') }}",
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        page_id: page_id
                    },
                    beforeSend: function () {
                        $("div.spanner").addClass("show");
                        $("div.overlay").addClass("show");
                    },
                    success: function (response) {
                        $('#order_container').empty().append(response.html).append(response.pagination);
                        account_settings.hide();
                        about.hide();
                        operating_hours.hide();
                        refund_policy.hide();
                        sales_tax_policy.hide();
                        shipping_policy.hide();
                        inventory.hide();
                        inventory_search.hide();
                        inventory_item.hide();
                        users.hide();
                        inventory_clear.hide();
                        order_container.show();
                        $("div.spanner").removeClass("show");
                        $("div.overlay").removeClass("show");

                        window.history.pushState(null, "Fluid", '/distributors/orders/'+ distributor_id);
                    }
                });
            }

            $('#orders_link').click(function (e){

                e.preventDefault();

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                inventory_clear.hide();
                order_container.empty().show();
                brand.empty().hide();

                getOrdersList($(this).data('distributor-id'), 1);
            });
            $(document).on('click', '.orders_link', function (e){

                e.preventDefault();

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                inventory_clear.hide();
                order_container.empty().show();
                brand.empty().hide();

                getOrdersList($(this).data('distributor-id'), 1);
            });
            $(document).on('click','.order-link', function (e){

                let distributor_id = window.location.pathname.split('/')[3];

                e.preventDefault();
                clearInterval(get_messages);
                getOrdersList(distributor_id, $(this).data('page-id'));

            });
            {# Order Details #}
            let is_order_detail = uri.match('/distributors/order/[0-9]+');
            let is_order_list = uri.match('/distributors/orders/[0-9]+');

            let orderid = '{{app.request.get('order_id')}}';
            let distributorid = '{{distributor.id}}';
            let clinicid = '{{clinic_id}}';

            if(is_order_list != null && '{{ app.request.get('distributor_id') }}' > 0) {

                getOrdersList('{{ app.request.get('distributor_id') }}', 1);
            }

            if(is_order_detail != null && orderid > 0 && distributorid > 0 && clinicid > 0) {

                getOrderDetails(orderid, distributorid, clinicid);
            }

            function getOrderDetails(order_id, distributor_id, clinic_id){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                inventory_clear.hide();
                order_container.show();

                $.ajax({
                    url: "{{ path('distributor_get_order_details') }}",
                    type: 'POST',
                    data: {
                        order_id: order_id
                    },
                    dataType: 'json',
                    success: function (response) {

                        // Reset page load time for refresh button alert
                        date_time = date.getFullYear() +'-'+ (date.getMonth() + 1) +'-'+ date.getDate() +' '+ String(date.getHours()).padStart(2, "0") + ":" + String(date.getMinutes()).padStart(2, "0") +':'+ String(date.getSeconds()).padStart(2, '0');
                        sessionStorage.setItem('date_time', date_time);

                        $('#order_container').empty().append(response);
                        $('#distributor_chat_inner').scrollTop($('#distributor_chat_inner').prop("scrollHeight"));
                        popOver();
                        getChat(order_id, distributor_id, clinic_id)
                        $('#chat_pulse').hide();

                        var maxWidth = Math.max.apply( null, $( '.badge' ).map( function () {
                            return $( this ).outerWidth( true );
                        }).get() );

                        $('.badge').css({'width':maxWidth+'px'});
                    }
                });
            }
            $(document).on('click', '.order_detail_link, .refresh-distributor-order', function (e){

                e.preventDefault();

                let order_id = $(this).data('order-id');
                let clinic_id = $(this).data('clinic-id');
                let distributor_id = $(this).data('distributor-id');

                sessionStorage.setItem('order_id', order_id);
                window.history.pushState(null, "Fluid", '/distributors/order/'+ order_id);

                getOrderDetails(order_id, distributor_id, clinic_id);
                checkLastModified(order_id);
            });

            function getLastModified(order_id){

                session_date_time = sessionStorage.getItem('date_time');

                $.ajax({
                    url: "{{ path('get_order_last_update') }}",
                    type: 'POST',
                    cache: false,
                    timeout: 10000,
                    data: {
                        order_id: order_id
                    },
                    success: function (response) {
                        console.log(response +' '+ session_date_time);
                        if (response > session_date_time) {
                            console.log('add class');
                            $('.refresh-distributor-order').removeClass('blinking-text').addClass('blinking-text');

                            date = new Date();
                            date_time = date.getFullYear() +'-'+ (date.getMonth() + 1) +'-'+ date.getDate() +' '+ String(date.getHours()).padStart(2, "0") + ":" + String(date.getMinutes()).padStart(2, "0") +':'+ String(date.getSeconds()).padStart(2, '0');

                            sessionStorage.setItem('date_time', date_time);

                        }
                    }
                });
            };

            function checkLastModified(order_id) {
                setInterval(function(){ getLastModified(order_id, distributor_id); }, 5000);
            }

            let chat_pulse = $('#chat_pulse');
            let chat_field = $('#chat_field');
            let order_id = $('#chat_field').data('order-id');
            let distributor_id = $('#chat_field').data('distributor-id');

            $.ajax({
                url: "{{ path('is_typing') }}",
                type: 'POST',
                dataType: 'json',
                data: {
                    order_id: order_id,
                    distributor_id: distributor_id,
                    is_typing: 0,
                },
                success: function (response) {

                    $('#chat_pulse').hide();
                }
            });
            $(document).on('click','#chat_field', function () {

                chat_pulse = $('#chat_pulse');
                chat_field = $('#chat_field');
                order_id = $(this).data('order-id');
                distributor_id = $(this).data('distributor-id');

                $.ajax({
                    url: "{{ path('is_typing') }}",
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        order_id: order_id,
                        distributor_id: distributor_id,
                        is_clinic: 0,
                        is_distributor: 1,
                        is_typing: 1,
                    },
                    success: function (response) {

                        if(response.clinic_is_typing > 0) {

                            $('#chat_pulse').show();

                        } else {

                            $('#chat_pulse').hide();
                        }
                    }
                });
            });
            $(document).on('blur','#chat_field', function (){

                $.ajax({
                    url: "{{ path('is_typing') }}",
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        order_id: order_id,
                        distributor_id: distributor_id,
                        is_clinic: 0,
                        is_distributor: 1,
                        is_typing: 0,
                    },
                    success: function (response) {

                        $(chat_pulse).hide();
                    }
                });
            });
            $(document).on('click', '#btn_chat_send', function (e){

                e.preventDefault();

                let message = $('#chat_field').val();

                if(message.length > 0){

                    $.ajax({
                        url:"{{ path('clinic_send_message') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            distributor: 1,
                            clinic: 0,
                            distributor_id: $(this).data('distributor-id'),
                            message: message,
                            order_id: $(this).data('order-id')
                        },
                        success: function(response) {
                            $('#distributor_chat_container').empty().append(response);
                            $('#distributor_chat_inner').scrollTop($('#distributor_chat_inner').prop("scrollHeight"));
                            $('#chat_field').val('');
                            $('#chat_pulse').hide();
                        }
                    });
                }
            });
            $(document).on('click', '#order_send_notification', function (e){

                e.preventDefault();

                let order_id = $(this).data('order-id');
                let distributor_id = $(this).data('distributor-id');
                let clinic_id = $(this).data('clinic-id');

                if(order_id > 0 && distributor_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_send_order_notification') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            order_id: order_id,
                            distributor_id: distributor_id,
                            clinic_id: clinic_id
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                            getFlash(response);
                        }
                    });
                }
            });
            $(document).on('click', '.btn_confirm', function (e){

                e.preventDefault();

                let item_id = $(this).data('item-id');

                if(item_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_update_order_item_status') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            item_id: item_id,
                            confirmed_status: 1
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                        }
                    });
                }
            });
            $(document).on('click', '.btn_pending', function (e){

                e.preventDefault();

                let item_id = $(this).data('item-id');

                if(item_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_update_order_item_status') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            item_id: item_id,
                            confirmed_status: 0
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                        }
                    });
                }
            });
            $(document).on('change', '.expiry-date', function (e){

                e.preventDefault();

                let item_id = $(this).data('item-id');
                let expiry_date = $(this).val();

                if(item_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_update_expiry_date') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            item_id: item_id,
                            expiry_date: expiry_date
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                        }
                    });
                }
            });
            $(document).on('change', '.item-price', function (e){

                e.preventDefault();

                let item_id = $(this).data('item-id');
                let price = $(this).val();

                if(item_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_update_price') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            item_id: item_id,
                            price: price
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                        }
                    });
                }
            });
            $(document).on('change', '.item-qty', function (e){

                e.preventDefault();

                let item_id = $(this).data('item-id');
                let qty = $(this).val();

                if(item_id > 0){

                    $.ajax({
                        url:"{{ path('distributor_update_qty') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            item_id: item_id,
                            qty: qty
                        },
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function(response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $('#basket_container').empty().append(response.orders);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");
                        }
                    });
                }
            });
            $(document).on('submit', '#form_distributor_orders', function (e){

                e.preventDefault();

                let data = new FormData(this);
                let product_id = data.getAll('product_id[]');
                let exp_dates = data.getAll('expiry_date[]');
                let prices = data.getAll('price[]');
                let qtys = data.getAll('qty[]');
                let is_valid = true;

                for($i = 0; $i < product_id.length; $i++){

                    let error_exp_date = $('#error_expiry_date_'+ product_id[$i]);
                    let error_price = $('#error_price_'+ product_id[$i]);
                    let error_qty = $('#error_qty_'+ product_id[$i]);
                    let exp_date = exp_dates[$i];
                    let price = prices[$i];
                    let qty = qtys[$i];

                    error_exp_date.hide();
                    error_price.hide();
                    error_qty.hide();

                    if((exp_date == '' || exp_date == 'undefined') && exp_date !== 0){

                        error_exp_date.show();
                        is_valid = false;
                    }

                    if(price == '' || price == 'undefined'){

                        error_price.show();
                        is_valid = false;
                    }

                    if(qty == '' || qty == 'undefined'){

                        error_qty.show();
                        is_valid = false;
                    }
                }

                if(is_valid) {

                    $.ajax({
                        url: "{{ path('distributor_update_order') }}",
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        cache: false,
                        timeout: 600000,
                        dataType: 'json',
                        data: data,
                        beforeSend: function () {
                            $("div.spanner").addClass("show");
                            $("div.overlay").addClass("show");
                        },
                        success: function (response) {
                            getFlash(response.flash);
                            getOrderDetails(response.order_id, response.distributor_id, response.clinic_id);
                            $("div.spanner").removeClass("show");
                            $("div.overlay").removeClass("show");

                            date = new Date();
                            date_time = date.getFullYear() +'-'+ (date.getMonth() + 1) +'-'+ date.getDate() +' '+ String(date.getHours()).padStart(2, "0") + ":" + String(date.getMinutes()).padStart(2, "0") +':'+ String(date.getSeconds()).padStart(2, '0');

                            sessionStorage.setItem('date_time', date_time);
                        }
                    });
                }
            });

            function getMessages(distributor_id, clinic_id){

                let uri = '{{ app.request.requestUri }}';
                let is_order_detail = uri.match('/[a-zA-Z]+/[a-zA-Z]+/[0-9]+');
                order_id = sessionStorage.getItem('order_id');

                if(is_order_detail != null && order_id > 0) {

                    let messages_sent = $('.speech-bubble-right').length;
                    let messages_received = $('.speech-bubble-left').length;
                    let total_messages = messages_sent + messages_received;

                    if('{{app.request.get('order_id')}}' != '') {
                        $.ajax({
                            url: "{{ path('get_messages') }}",
                            type: 'GET',
                            cache: false,
                            timeout: 10000,
                            data: {
                                distributor: 1,
                                clinic: 0,
                                order_id: order_id,
                                distributor_id: distributor_id,
                                clinic_id: clinic_id,
                                total_messages: total_messages
                            },
                            success: function (response) {

                                if (response.messages.length > 0) {

                                    $('#distributor_chat_container').empty().append(response.messages);
                                    $('#distributor_chat_inner').scrollTop($('#distributor_chat_inner').prop("scrollHeight"));
                                }

                                if (response.is_typing == 1) {

                                    $('#chat_pulse').show();

                                } else {

                                    $('#chat_pulse').hide();
                                }
                            }
                        });
                    }
                }
            };

            function getChat(order_id, distributor_id, clinic_id) {
                get_messages = setInterval(function(){ getMessages(distributor_id, clinic_id); }, 5000);
            }
            {# End Orders #}

            {# Account & Settings #}
            function getAccountSettings(){

                // International Numbers
                input = document.querySelector('#mobile');
                let iso_code = '{{ distributor.isoCode }}';
                iti = '';


                iti = window.intlTelInput(input, {
                    initialCountry: iso_code,
                    preferredCountries: ['ae','qa', 'bh', 'om', 'sa'],
                    autoPlaceholder: "polite",
                    nationalMode: true,
                    utilsScript: "{{ asset('js/utils.min.js') }}", // just for formatting/placeholders etc
                    separateDialCode: true,
                    utilsScript: "/js/utils.js",
                });

                let handleChange = function() {
                    let mobile = $('#telephone');
                    let mobile_number = (iti.isValidNumber()) ? iti.getNumber() : false;
                    let textNode = document.createTextNode(mobile_number);

                    if(mobile_number != false){

                        mobile.val(mobile_number.substring(1));
                    }
                };

                // listen to "keyup", but also "change" to update when the user selects a country
                input.addEventListener('change', handleChange);
                input.addEventListener('keyup', handleChange);

                account_settings.show();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                clearInterval(get_messages);
                window.history.pushState(null, "Fluid", '/distributors/account');
            }

            $('#account_settings_link').click(function (e){

                e.preventDefault();
                getAccountSettings();
            });

            {# About #}
            function getAbout(){

                account_settings.hide();
                about.show();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/about');
            }

            $('#about_link').click(function (e){

                e.preventDefault();
                getAbout();

            });

            {# Operating Hours #}
            function getOperatingHours(){

                account_settings.hide();
                about.hide();
                operating_hours.show();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/operating-hours');
            }

            $('#operating_hours_link').click(function (e){

                e.preventDefault();
                getOperatingHours();
            });

            {# Refund Policy #}
            function getRefundPolicy(){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.show();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/refund-policy');
            }

            $('#refund_policy_link').click(function (e){

                e.preventDefault();
                getRefundPolicy();
            });

            {# Sales Tax Policy #}
            function getSalesTaxPolicy(){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.show();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/sales-tax-policy');
            }

            $('#sales_tax_policy_link').click(function (e){

                e.preventDefault();
                getSalesTaxPolicy();
            });

            {# Shipping Policy #}
            function getShippingPolicy(){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.show();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/shipping-policy');
            }

            $('#shipping_policy_link').click(function (e){

                e.preventDefault();
                getShippingPolicy();
            });

            {# Inventory #}
            function getInventory(){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.show();
                inventory_search.show();
                inventory_item.hide();
                users.hide();
                order_container.hide();
                brand.empty().hide();

                window.history.pushState(null, "Fluid", '/distributors/manage-inventory');
            }

            $('#inventory_link').click(function (e){

                e.preventDefault();
                getInventory();
            });

            {# Users #}
            function getUsers(){

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.show();
                order_container.hide();
                brand.empty().append('<button type="button" class="btn btn-secondary btn-sm" data-bs-toggle="modal" data-bs-target="#modal_user" id="user_new"> <i class="fa-solid fa-circle-plus"></i> ADD COLLEAGUE</button>').show();

                window.history.pushState(null, "Fluid", '/distributors/users');
            }

            $('#users_link').click(function (e){

                e.preventDefault();
                getUsers();
            });

            {# Update Personal Information #}
            $('#btn_personal_information').click(function (e){

                e.preventDefault();

                let is_valid = true;
                let first_name = $('#first_name').val();
                let last_name = $('#last_name').val();
                let position = $('#position').val();
                let telephone = $('#telephone').val();
                let error_first_name = $('#error_first_name');
                let error_last_name = $('#error_last_name');
                let error_position = $('#error_position');
                let error_telephone = $('#error_telephone');

                error_first_name.hide();
                error_last_name.hide();
                error_position.hide();
                error_telephone.hide();

                if(first_name == '' || first_name == 'undefined'){

                    error_first_name.show();
                    is_valid = false;
                }

                if(last_name == '' || last_name == 'undefined'){

                    error_last_dashname.show();
                    is_valid = false;
                }

                if(position == '' || position == 'undefined'){

                    error_position.show();
                    is_valid = false;
                }

                if(telephone == '' || telephone == 'undefined'){

                    error_telephone.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $.ajax({
                        url: "{{ path('distributor_update_personal_information') }}",
                        type: 'POST',
                        data: {
                            first_name: first_name,
                            last_name: last_name,
                            position: position,
                            telephone: telephone,
                        },
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End Update Personal Information #}

            {# Update Company Information #}
            let logo = '{{ distributor.logo }}';

            if(logo != null || logo != ''){

                $('#logo_file').removeClass('col-12').addClass('col-11');
                $('#logo_col').removeClass('hidden');
            }

            $('#form_company_information').submit(function (e) {

                e.preventDefault();

                let is_valid = true;
                let company_name = $('#distributor_name').val();
                let email = $('#email').val();
                let telephone = $('#telephone').val();
                let country = $('#country').val();
                let street_address = $('#street_address').val();
                let city = $('#city').val();
                let postal_code = $('#postal_code').val();
                let state = $('#state').val();
                let error_company_name = $('#error_distributor_name');
                let error_email = $('#error_email');
                let error_telephone = $('#error_telephone');
                let error_country = $('#error_country');
                let error_street_address = $('#error_street_address');
                let error_city = $('#error_city');
                let error_postal_code = $('#error_postal_code');
                let error_state = $('#error_state');

                error_company_name.hide();
                error_email.hide();
                error_telephone.hide();
                error_country.hide();
                error_street_address.hide();
                error_city.hide();
                error_postal_code.hide();
                error_state.hide();

                if(company_name == '' || company_name == 'undefined'){

                    error_company_name.show();
                    is_valid = false;
                }

                if(email == '' || email == 'undefined'){

                    error_email.show();
                    is_valid = false;
                }

                if(telephone == '' || telephone == 'undefined'){

                    error_telephone.show();
                    is_valid = false;
                }

                if(country == '' || country == 'undefined'){

                    error_country.show();
                    is_valid = false;
                }

                if(street_address == '' || street_address == 'undefined'){

                    error_street_address.show();
                    is_valid = false;
                }

                if(city == '' || city == 'undefined'){

                    error_city.show();
                    is_valid = false;
                }

                if(postal_code == '' || postal_code == 'undefined'){

                    error_postal_code.show();
                    is_valid = false;
                }

                if(state == '' || state == 'undefined'){

                    error_state.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    let iso = iti.getSelectedCountryData().iso2;
                    let intl_code = iti.getSelectedCountryData().dialCode

                    $('<input />').attr('type', 'hidden').attr('name', 'distributor_form[iso_code]')
                        .attr('value', iso).appendTo('#form_company_information');
                    $('<input />').attr('type', 'hidden').attr('name', 'distributor_form[intl_code]')
                        .attr('value', intl_code).appendTo('#form_company_information');

                    // Create an FormData object
                    let data = new FormData(this);

                    $.ajax({
                        url: "{{ path('distributor_update_company_information') }}",
                        type: 'POST',
                        processData: false,
                        contentType: false,
                        data: data,
                        dataType: 'json',
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response.message);
                            $('#flash').removeClass('hidden');

                            if(response.logo != null && response.logo != ''){

                                $('#logo_img').attr('src', '/images/logos/' + response.logo);
                            }
                        }
                    });
                }
            });
            {# End Update Company Information #}

            {# About Us #}
            $('#form_about_us').submit(function(e){

                e.preventDefault();

                let is_valid = true;
                let about_us = CKEDITOR.instances.about_us.getData();
                let error_about_us = $('#error_about_us');

                error_about_us.hide();

                if(about_us == '' || about_us == 'undefined'){

                    error_about_us.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    // Create an FormData object

                    $.ajax({
                        url: "{{ path('distributor_update_about_us') }}",
                        type: 'POST',
                        dataType: 'json',
                        data: {
                            about_us: about_us
                        },
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End About Us #}

            {# Operating Hours #}
            $(document).on('click', '#btn_operating_hours', function(e){

                e.preventDefault();

                let is_valid = true;
                let operating_hours = CKEDITOR.instances.operating_hours_field.getData();
                let error_operating_hours = $('#error_operating_hours');

                error_operating_hours.hide();

                if(operating_hours == '' || operating_hours == 'undefined'){

                    error_operating_hours.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $.ajax({
                        url: "{{ path('distributor_update_operating_hours') }}",
                        type: 'POST',
                        data: {
                            operating_hours: operating_hours
                        },
                        dataType: 'json',
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End About Us #}

            {# Refund Policy #}
            $(document).on('click', '#btn_refund_policy', function(e){

                e.preventDefault();

                let is_valid = true;
                let refund_policy = CKEDITOR.instances.refund_policy_field.getData();
                let error_refund_policy = $('#error_about_us');

                error_refund_policy.hide();

                if(refund_policy == '' || refund_policy == 'undefined'){

                    error_refund_policy.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $.ajax({
                        url: "{{ path('distributor_update_refund_policy') }}",
                        type: 'POST',
                        data: {
                            refund_policy: refund_policy
                        },
                        dataType: 'json',
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End Refund Policy #}

            {# Sales Tax Policy #}
            $(document).on('click', '#btn_sales_tax_policy', function(e){

                e.preventDefault();

                let is_valid = true;
                let sales_tax_policy = CKEDITOR.instances.sales_tax_policy_field.getData();
                let error_sales_tax_policy = $('#error_sales_tax_policy');

                error_sales_tax_policy.hide();

                if(sales_tax_policy == '' || sales_tax_policy == 'undefined'){

                    error_sales_tax_policy.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $.ajax({
                        url: "{{ path('distributor_update_sales_tax_policy') }}",
                        type: 'POST',
                        data: {
                            sales_tax_policy: sales_tax_policy
                        },
                        dataType: 'json',
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End Sales Tax Policy #}

            {# Shipping Policy #}
            $(document).on('click', '#btn_shipping_policy', function(e){

                e.preventDefault();

                let is_valid = true;
                let shipping_policy = CKEDITOR.instances.shipping_policy_field.getData();
                let error_shipping_policy = $('#error_shipping_policy');

                error_shipping_policy.hide();

                if(shipping_policy == '' || shipping_policy == 'undefined'){

                    error_shipping_policy.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $.ajax({
                        url: "{{ path('distributor_update_shipping_policy') }}",
                        type: 'POST',
                        data: {
                            shipping_policy: shipping_policy
                        },
                        dataType: 'json',
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });
            {# End Shipping Policy #}

            {# Invenory / Distributor Products #}
            $('#form_inventory_item').submit(function(e){

                e.preventDefault();

                let is_valid = true;
                let unit_price = $('#unit_price');
                let error_unit_price = $('#error_unit_price');

                error_unit_price.hide();

                if(unit_price == '' || unit_price == 'undefined'){

                    error_unit_price.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    let data = new FormData(this);

                    $.ajax({
                        url: "{{ path('distributor_inventory_update') }}",
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        cache: false,
                        timeout: 600000,
                        dataType: 'json',
                        data: data,
                        success: function (response) {
                            $('#flash').addClass('alert-success');
                            $('#flash').removeClass('alert-danger');
                            $('#flash').addClass('alert');
                            $('#flash').addClass('text-center');
                            $('#flash').removeClass('users-flash');
                            $('#flash').addClass('users-flash');
                            $('#flash').empty();
                            $('#flash').append(response);
                            $('#flash').removeClass('hidden');
                        }
                    });
                }
            });

            $("#search_field").keyup(function(){

                $.ajax({
                    type: "POST",
                    url: "{{ path('distributor_inventory_search') }}",
                    data:'keyword='+$(this).val(),
                    success: function(data){
                        $("#suggestion_field").show();
                        $("#suggestion_field").html(data);
                    }
                });
            });
            {# End Invenory / Distributor Products #}

            {# Users #}
            $('#users_link').click(function (e){

                e.preventDefault();

                account_settings.hide();
                about.hide();
                operating_hours.hide();
                refund_policy.hide();
                sales_tax_policy.hide();
                shipping_policy.hide();
                inventory_search.hide();
                inventory_item.hide();
                users.show();
                order_container.hide();
            });
            $(document).on('click', '.user-pagination', function (e){

                e.preventDefault();
                let page_id = $(this).data('page-id');

                $.ajax({
                    url: "{{ path('distributor_refresh_users') }}",
                    type: 'POST',
                    dataType: 'json',
                    data: {
                        page_id: page_id
                    },
                    beforeSend: function (){
                        $("div.spanner").addClass("show");
                        $("div.overlay").addClass("show");
                    },
                    success: function (response) {
                        $('#users_list').empty().append(response);
                        $("div.spanner").removeClass("show");
                        $("div.overlay").removeClass("show");
                    }
                });
            });

            {# Clear Search #}
            $(document).on('click', '#inventory_clear', function (){

                $('#search_field').val('');
                $('#product_name').empty().append('Manage Your Inventory');
                $('#inventory_item').hide();
                $('#inventory_btn').hide();
                inventory_clear.hide();
            });

            {# Create User Btn #}
            $('#user_new').click(function (){

                $('#create_user').empty().append('CREATE USER');
                $('#user_modal_label').empty().append('Create a User');
                $('#user_id').val(0);
                $('#user_first_name').val('');
                $('#user_last_name').val('');
                $('#user_email').val('');
                $('#user_telephone').val('');
                $('#user_position').val('');
            });

            {# Update User #}
            $(document).on('click', '.update-user', function () {

                $('#create_user').empty().append('UPDATE USER');

                let user_id = $(this).data('user-id');

                $.ajax({
                    url: "{{ path('distributor_get_user') }}",
                    type: 'POST',
                    data: {
                        id: user_id
                    },
                    success: function (response) {

                        $('#telephone_container').empty().append('<input type="text" class="form-control" name="distributor_users_form[mobile]" id="user_mobile" value="" placeholder="(123) 456-7890*">');
                        $('#user_first_name').val(response.first_name);
                        $('#user_last_name').val(response.last_name);
                        $('#user_email').val(response.email);
                        $('#user_telephone').val(response.telephone);
                        $('#user_mobile').val(response.telephone);
                        $('#user_position').val(response.position);
                        $('#user_iso_code').val(response.iso_code);
                        $('#user_intl_code').val(response.intl_code);

                        let input = document.querySelector("#user_mobile");

                        iti = window.intlTelInput(input, {
                            preferredCountries: ['za','ae','qa', 'bh', 'om', 'sa'],
                            initialCountry: response.iso_code,
                            autoPlaceholder: "polite",
                            nationalMode: true,
                            utilsScript: "{{ asset('js/utils.min.js') }}", // just for formatting/placeholders etc
                            separateDialCode: true,
                            utilsScript: "/js/utils.js",
                        });
                    }
                });

                $('#user_id').val(user_id);
                $('#user_modal_label').empty().append('Update a User');
            });
            $(document).on('change','#user_mobile', function (){

                let input = document.querySelector("#user_mobile");

                let handleChange = function() {
                    let mobile = $('#user_telephone');
                    let mobile_number = (iti.isValidNumber()) ? iti.getNumber() : false;
                    let textNode = document.createTextNode(mobile_number);

                    if(mobile_number != false){

                        $('#user_telephone').val('');
                        $('#user_iso_code').val('');
                        $('#user_intl_code').val('');

                        let iso_code = iti.getSelectedCountryData().iso2;
                        let intl_code = iti.getSelectedCountryData().dialCode;

                        mobile.val(mobile_number.substring(1));
                        $('#user_iso_code').val(iso_code);
                        $('#user_intl_code').val(intl_code);

                    }
                };

                // listen to "keyup", but also "change" to update when the user selects a country
                input.addEventListener('change', handleChange);
                input.addEventListener('keyup', handleChange);
            });

            {# Delete User #}
            $(document).on('click', '.delete-user', function () {

                $('#delete_user').data('user-id', $(this).data('user-id'));
            });

            $(document).on('click', '#delete_user', function () {

                let user_id = $(this).data('user-id');

                $.ajax({
                    url: "{{ path('distributor_user_delete') }}",
                    type: 'POST',
                    data: {
                        id: user_id
                    },
                    success: function (response) {

                        getFlash(response);
                        $('#modal_user_delete').modal('hide');

                        $.ajax({
                            url: "{{ path('distributor_refresh_users') }}",
                            type: 'POST',
                            contentType: false,
                            processData: false,
                            cache: false,
                            timeout: 600000,
                            dataType: 'json',
                            success: function (response) {

                                $('#users_list').empty().append(response);
                            }
                        });
                    }
                });
            });

            {# Create User #}
            $('#form_users').submit(function(e){

                e.preventDefault();

                let is_valid = true;
                let user_first_name = $('#user_first_name').val()
                let user_last_name = $('#user_last_name').val();
                let user_email = $('#user_email').val();
                let user_telephone = $('#user_telephone').val();
                let error_user_first_name = $('#error_user_first_name');
                let error_user_last_name = $('#error_user_last_name');
                let error_user_email = $('#error_user_email');
                let error_user_telephone = $('#error_user_telephone');

                error_user_first_name.hide();
                error_user_last_name.hide();
                error_user_email.hide();
                error_user_telephone.hide();

                if(user_first_name == '' || user_first_name == 'undefined'){

                    error_user_first_name.show();
                    is_valid = false;
                }

                if(user_last_name == '' || user_last_name == 'undefined'){

                    error_user_last_name.show();
                    is_valid = false;
                }

                if(user_email == '' || user_email == 'undefined'){

                    error_user_email.show();
                    is_valid = false;
                }

                if(user_telephone == '' || user_telephone == 'undefined'){

                    error_user_telephone.show();
                    is_valid = false;
                }

                if(is_valid == true){

                    $("<input />").attr("type", "hidden").attr("name", "page_id").attr("value", $('#page_id').val()).appendTo("#form_users");

                    let data = new FormData(this);

                    $('#create_user').empty().attr('disabled', true).append('<span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span> PROCESSING...');

                    $.ajax({
                        url: "{{ path('distributor_users') }}",
                        type: 'POST',
                        contentType: false,
                        processData: false,
                        cache: false,
                        timeout: 600000,
                        dataType: 'json',
                        data: data,
                        success: function (response) {

                            if (response.response) {
                                getFlash(response.message);
                                $('#modal_user').modal('hide');
                                $('#user_first_name').val('');
                                $('#user_last_name').val('');
                                $('#user_email').val('');
                                $('#user_telephone').val('');
                                $('#user_position').val('');
                                $('#create_user').empty().append('SAVE').attr('disabled', false);

                                $.ajax({
                                    url: "{{ path('distributor_refresh_users') }}",
                                    type: 'POST',
                                    contentType: false,
                                    processData: false,
                                    cache: false,
                                    timeout: 600000,
                                    dataType: 'json',
                                    data: data,
                                    success: function (response) {
                                        $('#users_list').empty().append(response);
                                    }
                                });
                            } else {

                                $('#error_user_email').empty();
                                $('#error_user_email').append('Email address exists.');
                                $('#error_user_email').show();
                                $('#create_user').empty().append('SAVE').attr('disabled', false);
                            }
                        }
                    });
                }
            });
            {# End Users #}

            {# Popovers #}
            function popOver() {
                var popoverTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="popover"]'))
                var popoverList = popoverTriggerList.map(function (popoverTriggerEl) {
                    return new bootstrap.Popover(popoverTriggerEl)
                })
            }

            {# Clode Flash Message #}
            $('#flash').click(function (){
                $('#flash').addClass('hidden');
            });
        });

        function selectProduct(id, name) {

            if (id > 0) {

                $.ajax({
                    type: "POST",
                    url: "{{ path('distributor_inventory_get') }}",
                    data: {
                        product_id: id,
                    },
                    success: function (data) {

                        $("#suggestion_field").show();
                        $("#suggestion_field").html(data);
                        $('#product_id').val(id);
                        $('#distributor_id').val(data.distributor_id);
                        $('#sku').val(data.sku);
                        $('#distributor_no').val(data.distributor_no);
                        $('#unit_price').val(data.unit_price);
                        $('#stock_count').val(data.stock_count);
                        $('#expiry_date').val(data.expiry_date);
                        $('#dosage').val(data.product.dosage);
                        $('#size').val(data.product.size);
                        $('#pack_type').val(data.product.packType);
                        $('#unit').val(data.product.unit);
                        $('#active_ingredient').val(data.product.activeIngredient);
                        $('#btn_inventory').empty();
                        $('#btn_inventory').append('UPDATE ' + name.toUpperCase()).show();
                        $('#product_name').empty();
                        $('#product_name').append(name + data.product.dosage + data.product.unit + data.product.size);
                        $('#inventory_item').show();
                        $('#inventory_btn').show();
                        $('#inventory_clear').show();

                        $('#taxExempt_0').attr('checked', false);
                        $('#taxExempt_1').attr('checked', false);

                        if(data.tax_exempt == 0){

                            $('#taxExempt_0').attr('checked', true);

                        } else {

                            $('#taxExempt_1').attr('checked', true);
                        }
                    }
                });

                $("#search_field").val(name);
                $("#suggestion_field").hide();
            }
        }
    </script>
{% endblock %}
